<!DOCTYPE html>
<html>
<head>
    <title>X-WALL</title>
    <meta property="og:title" content="X-WALL" />
    <meta property="og:url" content="http://x-wall.org/" />
    <meta property="og:image" content="http://x-wall.org/images/logo-large.png" />
    <meta property="og:description" content="A small tool wrapped Plink and Privoxy together to provide people an easier way to CROSS the WALL." />
    <link href="style/main.css" rel="stylesheet" />
</head>
<body>
<div id="loading">...</div>
<script>
    var queryString = function () {
        var str = (document.location.href.match(/\?(.+)?/) || [])[1];
        var map = {};

        if (str) {
            var items = str.split("&");
            for (var i = 0; i < items.length; i++) {
                var groups = items[i].match(/([^=]+)=(.*)/);
                if (groups)
                    map[decodeURIComponent(groups[1])] = decodeURIComponent(groups[2]);
            }
        }

        return map;
    }();

    var debug = !!queryString["debug"];

    if (!debug) {
        "image preload",
        function () {
            var wrapper = document.body.appendChild(document.createElement("div"));
            var imageFiles = ["images/logo.png", "style/images/spirits.png"];
            for (var i = 0; i < imageFiles.length; i++) {
                var img = document.createElement("img");
                img.src = imageFiles[i];
                wrapper.appendChild(img);
            }
        }();
    }

    var lang = function () {
        var langs = [
            {
                name: "en-US",
                title: "X-WALL",
                loading: "loading...",
                font: "Segoe UI, Arial"
            },
            {
                name: "zh-CN",
                title: "X-WALL",
                loading: "正在加载...",
                font: "微软雅黑, 黑体"
            }
        ];

        var langName = queryString["lang"];

        langName =
            langName ||
            navigator.language ||
            navigator.userLanguage ||
            navigator.browserLanguage ||
            navigator.systemLanguage;

        return getLang(langName) || getLang(langName.substr(0, 2)) || langs[0];

        function getLang(name) {
            for (var i = 0; i < langs.length; i++) {
                if (langs[i].name.indexOf(name) == 0)
                    return langs[i];
            }
        }
    }();

    document.title = lang.title;
    document.body.style.fontFamily = lang.font;
    document.getElementById("loading").innerHTML = lang.loading;
</script>
<script src="scripts/vejis.js"></script>
<script>
    require_("scripts/main.js");

    //Google Analytics
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36452018-1']);
    _gaq.push(['_setDomainName', 'x-wall.org']);
    _gaq.push(['_trackPageview']);

    (function () {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
</body>
</html>
